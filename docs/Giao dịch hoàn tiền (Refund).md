### Giao dịch hoàn tiền (Refund)

\- API URL:https://sandbox.vnpayment.vn/merchant\_webapi/api/transaction

\- Phương thức:POST

\- Content-Type:Application/json

* Đây là API để hệ thống merchant gửi yêu cầu hoàn tiền cho giao dịch qua hệ thống Cổng thanh toán VNPAY.

#### Danh sách tham số gửi VNPAY (vnp\_Command=refund)

| Tham số | Kiểu dữ liệu | Bắt buộc/Tùy chọn | Mô tả |
| :---- | :---- | :---- | :---- |
| [vnp\_RequestId](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Alphanumeric\[1,32\] | Bắt buộc | Mã hệ thống merchant tự sinh ứng với mỗi yêu cầu hoàn trả giao dịch. Mã này là duy nhất dùng để phân biệt các yêu cầu hoàn trả giao dịch. Không được trùng lặp trong ngày. |
| [vnp\_Version](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Alphanumeric\[1,8\] | Bắt buộc | Phiên bản api mà merchant kết nối. Phiên bản hiện tại là 2.1.0 |
| [vnp\_Command](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Alpha\[1,16\] | Bắt buộc | Mã API sử dụng, mã cho giao dịch thanh toán là "refund" |
| [vnp\_TmnCode](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Alphanumeric\[8\] | Bắt buộc | Mã định danh kết nối của merchant trên hệ thống VNPAY. Các mã định danh kết nối tương ứng giữa các hệ thống: Thanh toán PAYđược quy định tại tham số "vnp\_TmnCode" Thanh toán bằng mã Tokenđược quy định tại tham số "vnp\_tmn\_code" Thanh toán trả gópđược quy định tại tham số "tmnCode" Thanh toán định kỳđược quy định tại tham số "tmnCode" |
| [vnp\_TransactionType](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Numeric\[1,15\] | Bắt buộc | Loại giao dịch tại hệ thống VNPAY: 02: Giao dịch hoàn trả toàn phần (vnp\_TransactionType=02) 03: Giao dịch hoàn trả một phần (vnp\_TransactionType=03) |
| [vnp\_TxnRef](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Alphanumeric\[1,100\] | Bắt buộc | Là mã giao dịch thanh toán của hệ thống merchant gửi VNPAY yêu cầu thanh toán. Tham khảo các giá trị qua các hệ thống thanh toán: Thanh toán PAYđược quy định tại tham số "vnp\_TxnRef" Thanh toán bằng mã Tokenđược quy định tại tham số "vnp\_txn\_ref" Thanh toán trả gópđược quy định tại tham số "order": {"orderReference": ""} chiều khởi tạo giao dịch trả góp Thanh toán định kỳđược quy định tại tham số "order": {"orderReference": ""} chiều yêu cầu thanh toán định kỳ |
| [vnp\_Amount](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Numeric\[1,12\] | Bắt buộc | Số tiền hoàn trả lại cho khách hàng. Số tiền này nhỏ hơn hoặc bằng số tiền của giao dịch Tham khảo các giá trị qua các hệ thống thanh toán: Thanh toán PAYđược quy định tại tham số "vnp\_Amount" Thanh toán bằng mã Tokenđược quy định tại tham số "vnp\_amount" Thanh toán trả gópđược quy định tại tham số "transaction": {"totalIspAmount": ""} chiều khởi tạo giao dịch trả góp và "vnp\_Amount" chiều VNPAY phản hồi kết quả thanh toán Thanh toán định kỳđược quy định tại tham số "transaction": {"recurringAmount": ""} chiều yêu cầu thanh toán định kỳ và "vnp\_amount" chiêu VNPAY phản hồi kết quả thanh toán |
| [vnp\_OrderInfo](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Alphanumeric\[1,255\] | Bắt buộc | Mô tả thông tin yêu cầu hoàn( Request description) |
| [vnp\_TransactionNo](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Numeric\[1,15\] | Tuỳ chọn | Mã giao dịch ghi nhận tại hệ thống VNPAY |
| [vnp\_TransactionDate](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Numeric\[14\] | Bắt buộc | Thời gian ghi nhận giao dịch tại website của merchant tính theo GMT+7, định dạng: yyyyMMddHHmmss, tham khảo giá trị: Thanh toán PAYgiống vnp\_CreateDate của vnp\_Command=pay Thanh toán bằng mã Tokengiống "vnp\_create\_date" của "vnp\_Command=pay\_and\_create" và "vnp\_command=token\_pay" Thanh toán trả gópgiống "transaction": {"mcDate": ""} chiều khởi tạo giao dịch trả góp Thanh toán định kỳgiống "transaction": {"mcDate": ""} chiều khởi tạo yêu cầu thanh toán định kỳ |
| [vnp\_CreateBy](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Alphanumeric\[1,245\] | Bắt buộc | Người khởi tạo hoàn tiền. Có thể là tên user thực hiện hoàn tiền của merchant. |
| [vnp\_CreateDate](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Numeric\[14\] | Bắt buộc | Thời gian phát sinh request hoàn (Request Date) GMT+7, định dạng: yyyyMMddHHmmss |
| [vnp\_IpAddr](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Alphanumeric\[7,45\] | Bắt buộc | Địa chỉ IP của máy chủ thực hiện gọi API |
| [vnp\_SecureHash](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Alphanumeric\[32,256\] | Bắt buộc | Mã kiểm tra (checksum) để đảm bảo dữ liệu không bị thay đổi trong quá trình gửi yêu cầu tử hệ thống merchant sang VNPAY. Quy tắc tạo checksum: data \= vnp\_RequestId \+ “|” \+ vnp\_Version \+ “|” \+ vnp\_Command \+ “|” \+ vnp\_TmnCode \+ “|” \+ vnp\_TransactionType \+ “|” \+ vnp\_TxnRef \+ “|” \+ vnp\_Amount \+ “|” \+ vnp\_TransactionNo \+ “|” \+ vnp\_TransactionDate \+ “|” \+ vnp\_CreateBy \+ “|” \+ vnp\_CreateDate \+ “|” \+ vnp\_IpAddr \+ “|” \+ vnp\_OrderInfo; checksum \= hashWithSecureType(secretKey, data); |

#### Danh sách tham số \- Thông tin nhận về từ VNPAY (vnp\_Command=refund)

| Tham số | Kiểu dữ liệu | Bắt buộc/Tùy chọn | Mô tả |
| :---- | :---- | :---- | :---- |
| [vnp\_ResponseId](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Alphanumeric\[1,32\] | Bắt buộc | Mã hệ thống VNPAY tự sinh ứng với mỗi yêu cầu hoàn trả giao dịch. Mã này là duy nhất dùng để phân biệt các yêu cầu hoàn trả giao dịch. Không được trùng lặp trong ngày |
| [vnp\_ResponseId](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Alphanumeric\[1,32\] | Bắt buộc | Mã hệ thống VNPAY tự sinh ứng với mỗi yêu cầu hoàn trả giao dịch. Mã này là duy nhất dùng để phân biệt các yêu cầu hoàn trả giao dịch. Không được trùng lặp trong ngày |
| [vnp\_Command](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Alphanumeric\[1,16\] | Tùy chọn | Mã API sử dụng, mã cho giao dịch thanh toán là "refund" |
| [vnp\_TmnCode](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Alphanumeric\[8\] | Tùy chọn | Mã định danh kết nối của hệ thống Các mã định danh kết nối tương ứng giữa các hệ thống: Thanh toán PAYđược quy định tại tham số "vnp\_TmnCode" Thanh toán bằng mã Tokenđược quy định tại tham số "vnp\_tmn\_code" Thanh toán trả gópđược quy định tại tham số "tmnCode" Thanh toán định kỳđược quy định tại tham số "tmnCode" |
| [vnp\_TxnRef](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Alphanumeric\[1,100\] | Bắt buộc | Mã tham chiếu của giao dịch tại hệ thống của merchant. Mã giao dịch thanh toán merchant gửi VNPAY yêu cầu hoàn tiền. Tham khảo các giá trị qua các hệ thống thanh toán: Thanh toán PAYđược quy định tại tham số "vnp\_TxnRef" Thanh toán bằng mã Tokenđược quy định tại tham số "vnp\_txn\_ref" Thanh toán trả gópđược quy định tại tham số "order": {"orderReference": ""} chiều khởi tạo giao dịch trả góp Thanh toán định kỳđược quy định tại tham số "order": {"orderReference": ""} chiều yêu cầu thanh toán định kỳ |
| [vnp\_Amount](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | numeric\[1,12\] | Bắt buộc | Số tiền hoàn. Tham khảo vnp\_Amount gửi sang VNPAY yêu cầu hoàn tiền Tham khảo các giá trị qua các hệ thống thanh toán: Thanh toán PAYđược quy định tại tham số "vnp\_Amount" Thanh toán bằng mã Tokenđược quy định tại tham số "vnp\_amount" Thanh toán trả gópđược quy định tại tham số "transaction": {"totalIspAmount": ""} chiều khởi tạo giao dịch trả góp và "vnp\_Amount" chiều VNPAY phản hồi kết quả thanh toán Thanh toán định kỳđược quy định tại tham số "transaction": {"recurringAmount": ""} chiều yêu cầu thanh toán định kỳ và "vnp\_amount" chiêu VNPAY phản hồi kết quả thanh toán |
| [vnp\_OrderInfo](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Numeric\[2\] | Bắt buộc | Nội dung của yêu cầu hoàn tiền |
| [vnp\_ResponseCode](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Numeric\[14\] | Bắt buộc | Mã phản hồi kết quả xử lý của API. Quy định mã trả lời 00 ứng với yêu cầu refund được thực hiện thành công. Tham khảo thêm tại bảng mã lỗi. |
| [vnp\_Message](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Alphanumeric\[10,255\] | Bắt buộc | Mô tả thông tin tương ứng với vnp\_ResponseCode |
| [vnp\_BankCode](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Alphanumeric\[3,20\] | Bắt buộc | Mã Ngân hàng hoặc mã Ví điện tử thanh toán |
| [vnp\_PayDate](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Numeric\[14\] | Tùy chọn | Ngày hoàn trả. Định dạng: yyyyMMddHHmmss |
| [vnp\_TransactionNo](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Numeric\[1,15\] | Bắt buộc | Mã giao dịch hoàn trả tương ứng ghi nhận tại hệ thống VNPAY |
| [vnp\_TransactionType](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Numeric\[2\] | Bắt buộc | Loại giao dịch tại hệ thống VNPAY: 02: Giao dịch hoàn trả toàn phần 03: Giao dịch hoàn trả một phần |
| [vnp\_TransactionStatus](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Numeric\[2\] | Bắt buộc | Tình trạng của giao dịch tại Cổng thanh toán VNPAY. Xem thêm tại bảng mã lỗi\# |
| [vnp\_SecureHash](https://sandbox.vnpayment.vn/apis/docs/truy-van-hoan-tien/querydr&refund.html#) | Alphanumeric\[32,256\] | Bắt buộc | Mã kiểm tra (checksum) để đảm bảo dữ liệu không bị thay đổi trong quá trình VNPAY trả kết quả về merchant. Quy tắc tạo checksum: data \= vnp\_ResponseId \+ “|” \+ vnp\_Command \+ “|” \+ vnp\_ResponseCode \+ “|” \+ vnp\_Message \+ “|” \+ vnp\_TmnCode \+ “|” \+ vnp\_TxnRef \+ “|” \+ vnp\_Amount \+ “|” \+ vnp\_BankCode \+ “|” \+ vnp\_PayDate \+ “|” \+ vnp\_TransactionNo \+ “|” \+ vnp\_TransactionType \+ “|” \+ vnp\_TransactionStatus \+ “|” \+ vnp\_OrderInfo; checksum \= hashWithSecureType(secretKey, data); |

